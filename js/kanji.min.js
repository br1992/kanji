function KanjiDeck(){var e,i,r=0,t=0,n=-1;this.readKanji=function(r){e=r.split(/[ ã€€\t\r\n]+/),""==e[0]&&e.shift(),e.length<3?(this.reset(),alert("No kanji available.")):(t=Math.floor(e.length/3),i=new Array(t),a(i,!1))},this.reset=function(){e=[],i=[],r=0,t=0,n=-1},this.getKanji=function(){return 0===t?[""]:[e[3*s()]]},this.getReading=function(){return 0>n?"":[e[3*n+1],e[3*n+2]]},this.numberKanji=function(){return t};var a=function(e,i){for(var r=e.length,t=0;r>t;t++)e[t]=i},s=function(){for(++r>t&&(a(i,!1),r=1);;)if(n=Math.floor(t*Math.random()),!i[n])break;return i[n]=!0,n}}function KanjiCard(e){var i=!1,r=e;this.readKanji=function(e){r.readKanji(e),i=!1},this.getWord=function(){var e;return e=i?r.getReading():r.getKanji(),i=!i,e},this.isFront=function(){return i},this.numberKanji=function(){return r.numberKanji()}}function KanjiQuiz(){var e=0,i=0,r=0;this.startQuiz=function(){this.resetQuiz()},this.resetQuiz=function(){i=0,r=0,e=0},this.numAnswered=function(){return i},this.numCorrect=function(){return r},this.isCorrect=function(e,t,n){var a=e.toLowerCase()===t.toLowerCase()||e.toLowerCase()===n.toLowerCase();return i++,a&&r++,!1||a},this.setNumKanji=function(i){e=i},this.quizFinished=function(){return e===i?!0:!1}}function getFiles(){var e,i;e=$("#fileChooser").get(0).files,i=e.length;for(var r=0;i>r;r++)readFiles(e[r])}function readFiles(e){var i=new FileReader;i.onload=function(){var r=i.result;$(kanjiList).val($(kanjiList).val()+r+"\n"),$("<li>"+e.name+"</li>").appendTo(fileList)},i.readAsText(e)}function kanjiTransition(e,i){notInTrans=!1,$(flashCard).css("transition","all "+transTime/1e3+"s linear"),$(flashCard).css("transform","perspective(800px) rotateY(90deg)"),$(flashCard).animate({color:"black"},transTime,function(){$(cardFront).css("visibility",e===!0?"hidden":"visible"),$(cardBack).css("visibility",e===!0?"visible":"hidden"),$(kanjiLabel).text(i),$(flashCard).css("transform","perspective(800px) rotateY("+(e===!0?"180":"0")+"deg)"),setTimeout(function(){notInTrans=!0},transTime)})}function onKeyDown(e){return 13==e.keyCode?(notInTrans&&(card.isFront()?checkAnswer():timeout&&(clearTimeout(timeout),timeoutTrans())),!1):void 0}function checkAnswer(){if(card.isFront()&&""!==$(kanjiLabel).text()){var e=card.getWord();$(quizBack).css("background-color",quiz.isCorrect($(answerField).val(),e[0],e[1])?green:red),kanjiTransition(!0,e[0]),$(answered).text(quiz.numAnswered()),$(correct).text(quiz.numCorrect()),timeout=setTimeout(function(){timeoutTrans()},1500)}}function timeoutTrans(){timeout=null,kanjiTransition(!1,card.getWord()[0]),$(answerForm)[0].reset(),quiz.quizFinished()&&(alert("You got "+(100*quiz.numCorrect()/quiz.numAnswered()).toFixed(2)+"% correct."),quiz.resetQuiz())}var transTime=250,flashCard=$(".flashCard"),quizCard=$("#quizCard"),cardFront=$(".cardFront"),cardBack=$(".cardBack"),kanjiLabel=$(".kanjiLabel"),kanjiList=$("#kanjiList"),fileList=$("#fileList"),answerForm=$("#answerForm"),answerField=$("#answerField"),quizBack=$("#quizBack"),answered=$("#numAnswered"),correct=$("#numCorrect"),green="rgb(28, 227, 44)",red="rgb(244, 97, 97)",timeout,notInTrans=!0,kanjiFiles=["https://cdn.rawgit.com/br1992/kanji/master/kanjirenshuu/Kanji.txt"],card=new KanjiCard(new KanjiDeck),quiz=new KanjiQuiz;$(document).ready(function(){window.File&&window.FileReader&&window.FileList&&window.Blob?$("#APIError").hide():alert("Your browser does not support the required features."),$("#fileChooser").change(function(){getFiles()}),$(flashCard).click(function(){"quizCard"!==this.id&&kanjiTransition(card.isFront(),card.getWord()[0])}),$("#clearButton").click(function(){$(fileList).empty(),$(kanjiList).val(""),$("#form")[0].reset(),$(kanjiLabel).text("")}),$(".tabs").on("click",function(e){("flashCards"===e.target.id||"quiz"===e.target.id)&&(card.readKanji($(kanjiList).val()),"quiz"===e.target.id&&(quiz.resetQuiz(),quiz.setNumKanji(card.numberKanji()),$(answered).text(0),$(correct).text(0)),kanjiTransition(!1,card.getWord()[0]))}),$("#submitButton").on("click",function(){checkAnswer()}),$("select[multiple] option").mousedown(function(){var i=this;return $(i).prop("selected",!0),$.get(kanjiFiles[this.value],function(e){kanjiList.val(kanjiList.val()+e+"\n\n"),setTimeout(function(){$(i).prop("selected",!1)},2*transTime)}),!1})});
