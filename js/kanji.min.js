function KanjiDeck(){var r,e,i=0,t=0,n=-1;this.readKanji=function(i){r=i.split(/[ ã€€\t\r\n]+/),""==r[0]&&r.shift(),r.length<3?(this.reset(),alert("No kanji available.")):(t=Math.floor(r.length/3),e=new Array(t),a(e,!1))},this.reset=function(){r=[],e=[],i=0,t=0,n=-1},this.getKanji=function(){return 0===t?[""]:[r[3*s()]]},this.getReading=function(){return 0>n?"":[r[3*n+1],r[3*n+2]]},this.numberKanji=function(){return t};var a=function(r,e){for(var i=r.length,t=0;i>t;t++)r[t]=e},s=function(){for(++i>t&&(a(e,!1),i=1);;)if(n=Math.floor(t*Math.random()),!e[n])break;return e[n]=!0,n}}function KanjiCard(r){var e=!1,i=r;this.readKanji=function(r){i.readKanji(r),e=!1},this.getWord=function(){var r;return r=e?i.getReading():i.getKanji(),e=!e,r},this.isFront=function(){return e},this.numberKanji=function(){return i.numberKanji()}}function KanjiQuiz(){var r=0,e=0,i=0;this.startQuiz=function(){this.resetQuiz()},this.resetQuiz=function(){e=0,i=0,r=0},this.numAnswered=function(){return e},this.numCorrect=function(){return i},this.isCorrect=function(r,t,n){var a=r.toLowerCase()===t.toLowerCase()||r.toLowerCase()===n.toLowerCase();return e++,a&&i++,!1||a},this.setNumKanji=function(e){r=e},this.quizFinished=function(){return r===e?!0:!1}}function getFiles(){var r,e;r=$("#fileChooser").get(0).files,e=r.length;for(var i=0;e>i;i++)readFiles(r[i])}function readFiles(r){var e=new FileReader;e.onload=function(){var i=e.result;$(kanjiList).val($(kanjiList).val()+i+"\n"),$("<li>"+r.name+"</li>").appendTo(fileList)},e.readAsText(r)}function kanjiTransition(r,e){notInTrans=!1,$(flashCard).css("transition","all "+transTime/1e3+"s linear"),$(flashCard).css("transform","perspective(800px) rotateY(90deg)"),$(flashCard).animate({color:"black"},transTime,function(){$(cardFront).css("visibility",r===!0?"hidden":"visible"),$(cardBack).css("visibility",r===!0?"visible":"hidden"),$(kanjiLabel).text(e),$(flashCard).css("transform","perspective(800px) rotateY("+(r===!0?"180":"0")+"deg)"),setTimeout(function(){notInTrans=!0},transTime)})}function onKeyDown(r){return 13==r.keyCode?(notInTrans&&(card.isFront()?checkAnswer():timeout&&(clearTimeout(timeout),timeoutTrans())),!1):void 0}function checkAnswer(){if(card.isFront()&&""!==$(kanjiLabel).text()){var r=card.getWord();$(quizBack).css("background-color",quiz.isCorrect($(answerField).val(),r[0],r[1])?green:red),kanjiTransition(!0,r[0]),$(answered).text(quiz.numAnswered()),$(correct).text(quiz.numCorrect()),timeout=setTimeout(function(){timeoutTrans()},1500)}}function timeoutTrans(){timeout=null,kanjiTransition(!1,card.getWord()[0]),$(answerForm)[0].reset(),quiz.quizFinished()&&(alert("You got "+(100*quiz.numCorrect()/quiz.numAnswered()).toFixed(2)+"% correct."),quiz.resetQuiz())}var transTime=250,flashCard=$(".flashCard"),quizCard=$("#quizCard"),cardFront=$(".cardFront"),cardBack=$(".cardBack"),kanjiLabel=$(".kanjiLabel"),kanjiList=$("#kanjiList"),fileList=$("#fileList"),answerForm=$("#answerForm"),answerField=$("#answerField"),quizBack=$("#quizBack"),answered=$("#numAnswered"),correct=$("#numCorrect"),green="rgb(28, 227, 44)",red="rgb(244, 97, 97)",timeout,notInTrans=!0,card=new KanjiCard(new KanjiDeck),quiz=new KanjiQuiz;$(document).ready(function(){window.File&&window.FileReader&&window.FileList&&window.Blob?$("#APIError").hide():alert("Your browser does not support the required features."),$("#fileChooser").change(function(){getFiles()}),$(flashCard).click(function(){"quizCard"!==this.id&&kanjiTransition(card.isFront(),card.getWord()[0])}),$("#clearButton").click(function(){$(fileList).empty(),$(kanjiList).val(""),$("#form")[0].reset(),$(kanjiLabel).text("")}),$(".tabs").on("click",function(r){("flashCards"===r.target.id||"quiz"===r.target.id)&&(card.readKanji($(kanjiList).val()),"quiz"===r.target.id&&(quiz.resetQuiz(),quiz.setNumKanji(card.numberKanji()),$(answered).text(0),$(correct).text(0)),kanjiTransition(!1,card.getWord()[0]))}),$("#submitButton").on("click",function(){checkAnswer()})});
